import { __awaiter, __generator, __spreadArrays } from "tslib";
// (C) 2022 GoodData Corporation
import { isElementsQueryOptionsElementsByPrimaryDisplayFormValue, isElementsQueryOptionsElementsByValue, NotImplemented, } from "@gooddata/sdk-backend-spi";
import { attributeElementsIsEmpty, isAttributeElementsByRef, } from "@gooddata/sdk-model";
import flow from "lodash/flow";
import { InMemoryPaging } from "./InMemoryPaging";
var resolveHiddenElements = function (hiddenElements) {
    return function (staticElements) {
        if (attributeElementsIsEmpty(hiddenElements)) {
            return staticElements;
        }
        return isAttributeElementsByRef(hiddenElements)
            ? staticElements.filter(function (item) { return !hiddenElements.uris.includes(item.uri); })
            : staticElements.filter(function (item) { return !hiddenElements.values.includes(item.title); });
    };
};
var resolveSelectedElements = function (selectedElements) {
    return function (staticElements) {
        if (!selectedElements) {
            return staticElements;
        }
        if (isElementsQueryOptionsElementsByPrimaryDisplayFormValue(selectedElements)) {
            throw new NotImplemented("Elements by primary display form value are not supported yet");
        }
        return isElementsQueryOptionsElementsByValue(selectedElements)
            ? staticElements.filter(function (element) { return selectedElements.values.includes(element.title); })
            : staticElements.filter(function (element) { return selectedElements.uris.includes(element.uri); });
    };
};
var resolveStringFilter = function (filter) {
    return function (staticElements) {
        return filter
            ? staticElements.filter(function (item) { return item.title.toLowerCase().includes(filter.toLowerCase()); })
            : staticElements;
    };
};
/**
 * @internal
 */
export function loadElementsFromStaticElements(options, hiddenElementsInfo, staticElements) {
    return __awaiter(this, void 0, void 0, function () {
        var resolvedElements;
        return __generator(this, function (_a) {
            resolvedElements = flow(resolveHiddenElements(hiddenElementsInfo.hiddenElements), resolveSelectedElements(options.elements), resolveStringFilter(options.search))(staticElements);
            if (options.order === "desc") {
                resolvedElements = __spreadArrays(resolvedElements).reverse();
            }
            return [2 /*return*/, new InMemoryPaging(resolvedElements, options.limit, options.offset)];
        });
    });
}
//# sourceMappingURL=loadElementsFromStaticElements.js.map