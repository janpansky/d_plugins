// (C) 2022 GoodData Corporation
import { __read } from "tslib";
import { useEffect, useCallback } from "react";
import { useNumberState } from "./useNumberState";
import { useContentHeight } from "./useContentHeight";
export function useScrollEvent(content, size, onScroll) {
    var _a = __read(useNumberState(), 2), top = _a[0], setTop = _a[1];
    var _b = __read(useNumberState(), 2), bottom = _b[0], setBottom = _b[1];
    var contentHeight = useContentHeight(content);
    useEffect(function () {
        calculateOpacities(content, size, [top, setTop], [bottom, setBottom]);
    }, [bottom, setBottom, setTop, size, top, content, contentHeight]);
    var onScrollHandler = useCallback(function (event) {
        calculateOpacities(content, size, [top, setTop], [bottom, setBottom]);
        onScroll === null || onScroll === void 0 ? void 0 : onScroll(event);
    }, [bottom, onScroll, setBottom, setTop, size, top, content]);
    return { top: top, bottom: bottom, onScrollHandler: onScrollHandler };
}
function calculateOpacities(content, size, t, b) {
    var scrollTop = content ? content.scrollTop : 0;
    var topOpacity = calculateOpacity(scrollTop, size);
    var scrollBottom = content ? content.scrollHeight - content.offsetHeight - content.scrollTop : 0;
    var bottomOpacity = calculateOpacity(scrollBottom, size);
    var _a = __read(t, 2), top = _a[0], setTop = _a[1];
    if (top !== topOpacity) {
        setTop(topOpacity);
    }
    var _b = __read(b, 2), bottom = _b[0], setBottom = _b[1];
    if (bottom !== bottomOpacity) {
        setBottom(bottomOpacity);
    }
}
function calculateOpacity(current, size) {
    var opacity = Math.min(current / size, 1);
    if (opacity > 0) {
        return Math.max(opacity, 0.2);
    }
    return opacity;
}
//# sourceMappingURL=useScrollEvent.js.map