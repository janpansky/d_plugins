// (C) 2021-2023 GoodData Corporation
import React, { useCallback, useMemo } from "react";
import { FormattedMessage, useIntl } from "react-intl";
import cx from "classnames";
import { isGranteeUser, isGranteeGroup, isGranteeGroupAll, isGranularGranteeUser, isGranularGranteeGroup, } from "./types";
import { getGranteeLabel, getGranteeItemTestId } from "./utils";
import { GranteeGroupIcon, GranteeOwnerRemoveIcon, GranteeRemoveIcon, GranteeUserIcon, GranteeUserInactiveIcon, } from "./GranteeIcons";
import { Button } from "../../../Button";
import { GranularGranteeUserItem } from "./GranularPermissions/GranularGranteeUserItem";
import { GranularGranteeGroupItem } from "./GranularPermissions/GranularGranteeGroupItem";
import invariant from "ts-invariant";
var granteeUserTitleRenderer = function (grantee, intl) {
    var userName = getGranteeLabel(grantee, intl);
    if (grantee.status === "Inactive") {
        var inactiveLabel = " (" + intl.formatMessage({
            id: "shareDialog.share.grantee.item.user.inactive",
        }) + ")";
        return (React.createElement(React.Fragment, null,
            userName,
            React.createElement("span", { className: "gd-grantee-content-label-inactive" }, inactiveLabel)));
    }
    return React.createElement(React.Fragment, null,
        " ",
        userName,
        " ");
};
var GranteeUserItem = function (props) {
    var grantee = props.grantee, mode = props.mode, onDelete = props.onDelete;
    var intl = useIntl();
    var onClick = useCallback(function () {
        onDelete(grantee);
    }, [grantee, onDelete]);
    var itemClassName = cx({ "s-share-dialog-owner": grantee.isOwner, "s-share-dialog-current-user": grantee.isCurrentUser }, "gd-share-dialog-grantee-item", getGranteeItemTestId(grantee));
    return (React.createElement("div", { className: itemClassName },
        grantee.isOwner ? (React.createElement(GranteeOwnerRemoveIcon, null)) : (React.createElement(GranteeRemoveIcon, { mode: mode, onClick: onClick })),
        React.createElement("div", { className: "gd-grantee-content" },
            React.createElement("div", { className: "gd-grantee-content-label" }, granteeUserTitleRenderer(grantee, intl)),
            React.createElement("div", { className: "gd-grantee-content-label gd-grantee-content-email" }, grantee.email)),
        grantee.status === "Active" ? React.createElement(GranteeUserIcon, null) : React.createElement(GranteeUserInactiveIcon, null)));
};
var GranteeUserInactiveItem = function (props) {
    var grantee = props.grantee;
    var intl = useIntl();
    var granteeLabel = useMemo(function () {
        return getGranteeLabel(grantee, intl);
    }, [grantee, intl]);
    var itemClassName = cx("gd-share-dialog-grantee-item", "s-share-dialog-inactive-owner", getGranteeItemTestId(grantee));
    return (React.createElement("div", { className: itemClassName },
        React.createElement(GranteeOwnerRemoveIcon, null),
        React.createElement("div", { className: "gd-grantee-content" },
            React.createElement("div", { className: "gd-grantee-content-label-inactive" }, granteeLabel),
            React.createElement("div", { className: "gd-grantee-content-label-inactive gd-grantee-content-inactive" },
                React.createElement(FormattedMessage, { id: "shareDialog.share.grantee.item.user.inactive.description" }))),
        React.createElement(GranteeUserInactiveIcon, null)));
};
var GranteeGroupItem = function (props) {
    var grantee = props.grantee, onDelete = props.onDelete, mode = props.mode;
    var intl = useIntl();
    var onClick = useCallback(function () {
        onDelete(grantee);
    }, [grantee, onDelete]);
    var groupName = useMemo(function () { return getGranteeLabel(grantee, intl); }, [grantee, intl]);
    var numOfUsers = useMemo(function () {
        if (grantee.memberCount) {
            return intl.formatMessage({
                id: "shareDialog.share.grantee.item.users.count",
            }, { granteeCount: grantee.memberCount });
        }
    }, [grantee, intl]);
    var itemClassName = cx("gd-share-dialog-grantee-item", getGranteeItemTestId(grantee));
    return (React.createElement("div", { className: itemClassName },
        React.createElement(GranteeRemoveIcon, { mode: mode, onClick: onClick }),
        React.createElement("div", { className: "gd-grantee-content" },
            React.createElement("div", { className: "gd-grantee-content-label" }, groupName),
            numOfUsers ? (React.createElement("div", { className: "gd-grantee-count-button" },
                React.createElement(Button, { className: "gd-button-link-dimmed gd-button gd-grantee-content-user-count s-grantee-content-user-count", value: numOfUsers }))) : null),
        React.createElement(GranteeGroupIcon, null)));
};
/**
 * @internal
 */
export var GranteeItemComponent = function (props) {
    var grantee = props.grantee, mode = props.mode, currentUserPermissions = props.currentUserPermissions, isSharedObjectLocked = props.isSharedObjectLocked, onDelete = props.onDelete, onChange = props.onChange;
    if (isGranularGranteeUser(grantee)) {
        return (React.createElement(GranularGranteeUserItem, { currentUserPermissions: currentUserPermissions, isSharedObjectLocked: isSharedObjectLocked, grantee: grantee, onChange: onChange, onDelete: onDelete, mode: mode }));
    }
    else if (isGranularGranteeGroup(grantee)) {
        return (React.createElement(GranularGranteeGroupItem, { currentUserPermissions: currentUserPermissions, isSharedObjectLocked: isSharedObjectLocked, grantee: grantee, onChange: onChange, onDelete: onDelete, mode: mode }));
    }
    else if (isGranteeUser(grantee)) {
        return React.createElement(GranteeUserItem, { grantee: grantee, mode: mode, onDelete: onDelete });
    }
    else if (grantee.type === "inactive_owner") {
        return React.createElement(GranteeUserInactiveItem, { grantee: grantee });
    }
    else if (isGranteeGroup(grantee) || isGranteeGroupAll(grantee)) {
        return React.createElement(GranteeGroupItem, { grantee: grantee, mode: mode, onDelete: onDelete });
    }
    else {
        invariant(grantee, "Illegal grantee used.");
    }
};
//# sourceMappingURL=GranteeItem.js.map