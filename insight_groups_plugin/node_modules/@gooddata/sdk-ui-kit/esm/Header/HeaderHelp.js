import { __read, __spread } from "tslib";
// (C) 2021-2022 GoodData Corporation
import React, { useState, useRef } from "react";
import { FormattedMessage, injectIntl } from "react-intl";
import cx from "classnames";
import isEmpty from "lodash/isEmpty";
import { Overlay } from "../Overlay";
export var CoreHeaderHelp = function (_a) {
    var _b;
    var className = _a.className, items = _a.items, helpMenuDropdownAlignPoints = _a.helpMenuDropdownAlignPoints, onMenuItemClick = _a.onMenuItemClick, disableDropdown = _a.disableDropdown, onHelpClicked = _a.onHelpClicked, helpRedirectUrl = _a.helpRedirectUrl;
    var _c = __read(useState(false), 2), isOpen = _c[0], setIsOpen = _c[1];
    var helpMenuRef = useRef(null);
    var classNames = cx((_b = {
            "gd-header-help": true,
            "gd-icon-header-help": true,
            "is-open": isOpen && !helpRedirectUrl,
            "anchor-tag-header-help": !isEmpty(helpRedirectUrl)
        },
        _b[className] = !!className,
        _b));
    var menuItems = items.map(function (item) {
        var _a;
        return (React.createElement("a", { key: item.key, href: item.href, target: item.target, rel: item.target === "_blank" ? "noreferrer noopener" : undefined, onClick: function () {
                menuItemClicked(item);
            }, className: cx("gd-list-item gd-list-help-menu-item", (_a = {}, _a[item.className] = !!item.className, _a)) },
            item.iconName ? React.createElement("i", { className: cx(item.iconName, "gd-icon") }) : null,
            React.createElement("span", null,
                React.createElement(FormattedMessage, { id: item.key }))));
    });
    var toggleHelpMenu = function (isMenuOpen) {
        if (isMenuOpen === void 0) { isMenuOpen = !isOpen; }
        onHelpClicked === null || onHelpClicked === void 0 ? void 0 : onHelpClicked(isMenuOpen);
        setIsOpen(isMenuOpen);
    };
    var menuItemClicked = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        toggleHelpMenu(false);
        onMenuItemClick.apply(void 0, __spread(args));
    };
    /**
     * Menu dropdown content is long enough to make it max-width (240px),
     * so it should just switch alignment to bottom right corner of the Help button.
     */
    var getHelpDropdownAlignPoints = function () {
        var defaultAlignPoints = [
            {
                align: "br tr",
            },
        ];
        var helpMenuCurrentRef = helpMenuRef === null || helpMenuRef === void 0 ? void 0 : helpMenuRef.current;
        if (!helpMenuCurrentRef ||
            !helpMenuDropdownAlignPoints ||
            helpMenuDropdownAlignPoints === "br tr" ||
            window.innerWidth - helpMenuCurrentRef.offsetLeft < 240) {
            return defaultAlignPoints;
        }
        return [
            {
                align: helpMenuDropdownAlignPoints,
            },
        ];
    };
    var renderHelpMenu = function () {
        return isOpen ? (React.createElement(Overlay, { alignTo: ".gd-header-help", alignPoints: getHelpDropdownAlignPoints(), closeOnOutsideClick: true, closeOnMouseDrag: true, closeOnParentScroll: true, onClose: function () {
                toggleHelpMenu(false);
            } }, !disableDropdown ? (React.createElement("div", { className: "gd-dialog gd-dropdown overlay gd-header-help-dropdown" },
            React.createElement("div", { className: "gd-list small" }, menuItems))) : null)) : (false);
    };
    return helpRedirectUrl ? (React.createElement("a", { className: classNames, href: helpRedirectUrl, target: "_blank", rel: "noreferrer noopener" },
        React.createElement(FormattedMessage, { id: "gs.header.help" }))) : (React.createElement("div", { className: classNames, onClick: function () { return toggleHelpMenu(); }, ref: helpMenuRef },
        React.createElement(FormattedMessage, { id: "gs.header.help" }),
        renderHelpMenu()));
};
export var HeaderHelp = injectIntl(CoreHeaderHelp);
//# sourceMappingURL=HeaderHelp.js.map