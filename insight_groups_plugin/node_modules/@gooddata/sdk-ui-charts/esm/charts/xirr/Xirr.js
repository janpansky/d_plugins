import { __assign, __spreadArrays } from "tslib";
// (C) 2007-2022 GoodData Corporation
import React from "react";
import { bucketsAttributes, MeasureGroupIdentifier, newBucket, newDimension, } from "@gooddata/sdk-model";
import { BucketNames, useResolveValuesWithPlaceholders, withContexts, } from "@gooddata/sdk-ui";
import { CoreXirr } from "./CoreXirr";
import omit from "lodash/omit";
var WrappedXirr = withContexts(RenderXirr);
/**
 * Xirr computes the {@link https://en.wikipedia.org/wiki/Internal_rate_of_return | Internal Rate of Return} from the given measure and date dimension.
 *
 *
 * @remarks
 * The "X" in the name means that the returns do not have to happen periodically (as in the standard IRR), but they
 * can {@link https://en.wikipedia.org/wiki/Internal_rate_of_return#Exact_dates_of_cash_flows | happen at any day}.
 * You must specify both the measure and date dimension.
 *
 * For date parsing, we currently use the browser's Date constructor. There might be some differences
 * between how browsers implement this, so for best results use the Day granularity if possible.
 *
 * See {@link IXirrProps} to learn how to configure the Xirr.
 *
 * @beta
 */
export var Xirr = function (props) {
    var _a = useResolveValuesWithPlaceholders([props.measure, props.attribute, props.filters], props.placeholdersResolutionContext), measure = _a[0], attribute = _a[1], filters = _a[2];
    return React.createElement(WrappedXirr, __assign({}, props, { measure: measure, attribute: attribute, filters: filters }));
};
export function RenderXirr(props) {
    return React.createElement(CoreXirr, __assign({}, toCoreXirrProps(props)));
}
export function toCoreXirrProps(props) {
    var buckets = [
        newBucket(BucketNames.MEASURES, props.measure),
        newBucket(BucketNames.ATTRIBUTE, props.attribute),
    ];
    var newProps = omit(props, [
        "measure",
        "attribute",
        "filters",
        "backend",
    ]);
    return __assign(__assign({}, newProps), { execution: createExecution(buckets, props), exportTitle: props.exportTitle || "Xirr" });
}
function createExecution(buckets, props) {
    var backend = props.backend, workspace = props.workspace, execConfig = props.execConfig;
    return backend
        .withTelemetry("Xirr", props)
        .workspace(workspace)
        .execution()
        .forBuckets(buckets, props.filters)
        .withDimensions(newDimension(__spreadArrays([MeasureGroupIdentifier], bucketsAttributes(buckets))))
        .withExecConfig(execConfig);
}
//# sourceMappingURL=Xirr.js.map