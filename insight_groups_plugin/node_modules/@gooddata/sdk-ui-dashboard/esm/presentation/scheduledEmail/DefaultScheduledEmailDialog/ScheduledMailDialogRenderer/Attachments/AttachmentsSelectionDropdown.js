// (C) 2022 GoodData Corporation
import { __assign, __read } from "tslib";
import * as React from "react";
import { useCallback, useState } from "react";
import { FormattedMessage, useIntl } from "react-intl";
import identity from "lodash/identity";
import { Icon, InsightIcon, Typography } from "@gooddata/sdk-ui-kit";
import { useTheme } from "@gooddata/sdk-ui-theme-provider";
import { objRefToString } from "@gooddata/sdk-model";
import { ScheduleDropdown } from "./ScheduleDropdown";
export var AttachmentsSelectionDropdown = function (props) {
    var _a, _b;
    var dashboardTitle = props.dashboardTitle, _c = props.insightWidgets, insightWidgets = _c === void 0 ? [] : _c, onApply = props.onApply;
    var intl = useIntl();
    var theme = useTheme();
    var ICON_COLOR = (_b = (_a = theme === null || theme === void 0 ? void 0 : theme.palette) === null || _a === void 0 ? void 0 : _a.complementary) === null || _b === void 0 ? void 0 : _b.c5;
    var ICON_SIZE_BUTTON = 18;
    var ICON_PROPS = { color: ICON_COLOR, height: 19, width: 26 };
    var _d = __read(useState(props.dashboardSelected), 2), dashboardSelected = _d[0], setDashboardSelected = _d[1];
    var _e = __read(useState(props.widgetsSelected), 2), widgetsSelected = _e[0], setWidgetsSelected = _e[1];
    var handleWidgetSelectedChange = useCallback(function (widgetRef) {
        var _a;
        var widgetRefKey = objRefToString(widgetRef);
        setWidgetsSelected(__assign(__assign({}, widgetsSelected), (_a = {}, _a[widgetRefKey] = !widgetsSelected[widgetRefKey], _a)));
    }, [widgetsSelected]);
    var handleOnApply = useCallback(function () {
        onApply(dashboardSelected, widgetsSelected);
    }, [onApply, dashboardSelected, widgetsSelected]);
    var handleOnCancel = useCallback(function () {
        setDashboardSelected(props.dashboardSelected);
        setWidgetsSelected(props.widgetsSelected);
    }, [props.dashboardSelected, props.widgetsSelected]);
    var canApply = (dashboardSelected || Object.values(widgetsSelected).some(identity)) &&
        (dashboardSelected != props.dashboardSelected ||
            JSON.stringify(widgetsSelected) !== JSON.stringify(props.widgetsSelected));
    return (React.createElement(ScheduleDropdown, { title: intl.formatMessage({ id: "dialogs.schedule.email.attachment.select" }), applyDisabled: !canApply, onApply: handleOnApply, onCancel: handleOnCancel, buttonClassName: "s-schedule-select-attachments-button", bodyClassName: "s-schedule-select-attachments-body", buttonDisabled: insightWidgets.length === 0, iconComponent: React.createElement(Icon.AttachmentClip, { color: ICON_COLOR, width: ICON_SIZE_BUTTON, height: ICON_SIZE_BUTTON }), contentComponent: React.createElement("div", { className: "gd-attachments-selection-dropdown" },
            React.createElement(Typography, { tagName: "h3" },
                React.createElement(FormattedMessage, { id: "dialogs.schedule.email.attachment.select.dashboard.header" })),
            React.createElement("div", null,
                React.createElement("label", { className: "input-checkbox-label s-schedule-dashboard-attachment-label" },
                    React.createElement("input", { type: "checkbox", className: "input-checkbox", checked: dashboardSelected, onChange: function (event) { return setDashboardSelected(event.target.checked); } }),
                    React.createElement(Icon.Dashboard, __assign({}, ICON_PROPS)),
                    React.createElement("span", { title: dashboardTitle, className: "input-label-text" }, dashboardTitle))),
            React.createElement(Typography, { tagName: "h3" },
                React.createElement(FormattedMessage, { id: "dialogs.schedule.email.attachment.select.widgets.header" })),
            insightWidgets.map(function (widget) { return (React.createElement("div", { key: objRefToString(widget) },
                React.createElement("label", { className: "input-checkbox-label s-schedule-widget-attachment-label" },
                    React.createElement("input", { type: "checkbox", className: "input-checkbox", checked: widgetsSelected[objRefToString(widget)], onChange: function () { return handleWidgetSelectedChange(widget); } }),
                    React.createElement(InsightIcon, { visualizationUrl: widget.visualizationUrl, iconProps: ICON_PROPS }),
                    React.createElement("span", { title: widget.title, className: "input-label-text" }, widget.title)))); })) }));
};
//# sourceMappingURL=AttachmentsSelectionDropdown.js.map