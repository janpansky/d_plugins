// (C) 2022 GoodData Corporation
import { __read, __spread } from "tslib";
import React, { useCallback } from "react";
import { FormattedMessage, useIntl } from "react-intl";
import cx from "classnames";
import { Bubble, BubbleHoverTrigger, ShortenedText } from "@gooddata/sdk-ui-kit";
import { useTheme } from "@gooddata/sdk-ui-theme-provider";
import { getAttachmentType, getFormatsLabel, getRecipientsLabel } from "./utils";
import { gdColorDisabled } from "../../constants/colors";
var ICON_TOOLTIP_ALIGN_POINTS = [
    { align: "cr cl", offset: { x: 0, y: 0 } },
    { align: "cl cr", offset: { x: 0, y: 0 } },
];
var TEXT_TOOLTIP_ALIGN_POINTS = [
    { align: "tc bc", offset: { x: 0, y: 0 } },
    { align: "bc tc", offset: { x: 0, y: 0 } },
];
export var ScheduledEmail = function (props) {
    var _a, _b, _c;
    var intl = useIntl();
    var theme = useTheme();
    var scheduledEmail = props.scheduledEmail, currentUserEmail = props.currentUserEmail, onDelete = props.onDelete, onEdit = props.onEdit, canManageScheduledMail = props.canManageScheduledMail;
    var subject = scheduledEmail.subject, to = scheduledEmail.to, bcc = scheduledEmail.bcc, attachments = scheduledEmail.attachments;
    var recipients = __spread(to, (bcc !== null && bcc !== void 0 ? bcc : []));
    var recipientsLabel = getRecipientsLabel(intl, recipients, currentUserEmail);
    var formatsLabel = getFormatsLabel(attachments);
    var _d = getAttachmentType(intl, attachments), AttachmentIcon = _d.AttachmentIcon, attachmentLabel = _d.attachmentLabel;
    var subtitle = recipientsLabel + " \u2022 " + attachmentLabel + " \u2022 " + formatsLabel;
    var handleClick = useCallback(function () {
        if (canManageScheduledMail) {
            onEdit(scheduledEmail);
        }
    }, [scheduledEmail, canManageScheduledMail]);
    return (React.createElement("div", { className: cx("gd-scheduled-email", "s-scheduled-email", { editable: canManageScheduledMail }) },
        React.createElement("div", { className: "gd-scheduled-email-delete" },
            React.createElement(BubbleHoverTrigger, { showDelay: 0, hideDelay: 0 },
                React.createElement("span", { className: "gd-scheduled-email-delete-icon s-scheduled-email-delete-icon", onClick: function () { return onDelete(scheduledEmail); } }),
                React.createElement(Bubble, { className: "bubble-primary", alignPoints: ICON_TOOLTIP_ALIGN_POINTS },
                    React.createElement(FormattedMessage, { id: "dialogs.schedule.management.delete" })))),
        React.createElement("div", { className: "gd-scheduled-email-content", onClick: handleClick },
            React.createElement("div", { className: "gd-scheduled-email-icon" },
                React.createElement(AttachmentIcon, { color: (_c = (_b = (_a = theme === null || theme === void 0 ? void 0 : theme.palette) === null || _a === void 0 ? void 0 : _a.complementary) === null || _b === void 0 ? void 0 : _b.c5) !== null && _c !== void 0 ? _c : gdColorDisabled, width: 18, height: 16 })),
            React.createElement("div", { className: "gd-scheduled-email-text-content" },
                React.createElement("div", { className: "gd-scheduled-email-title" },
                    React.createElement("strong", null,
                        React.createElement(ShortenedText, { className: "gd-scheduled-email-shortened-text", tooltipAlignPoints: TEXT_TOOLTIP_ALIGN_POINTS }, subject))),
                React.createElement("div", null,
                    React.createElement("span", { className: "gd-scheduled-email-subtitle" },
                        React.createElement(ShortenedText, { className: "gd-scheduled-email-shortened-text", tooltipAlignPoints: TEXT_TOOLTIP_ALIGN_POINTS }, subtitle)))))));
};
//# sourceMappingURL=ScheduledEmail.js.map