// (C) 2021-2022 GoodData Corporation
import React, { useCallback } from "react";
import { useIntl } from "react-intl";
import { Button } from "@gooddata/sdk-ui-kit";
import { selectCanCreateAnalyticalDashboard, selectEnableKPIDashboardSaveAsNew, selectIsExport, uiActions, useDashboardDispatch, useDashboardSelector, } from "../../../../../model";
import { selectCanEnterEditModeAndIsLoaded } from "../selectors";
import { selectDashboardEditModeDevRollout, selectIsSaveAsNewButtonHidden, } from "../../../../../model/store/config/configSelectors";
import { createSelector } from "@reduxjs/toolkit";
/**
 * @internal
 */
export var selectIsSaveAsNewButtonVisible = createSelector(selectDashboardEditModeDevRollout, selectEnableKPIDashboardSaveAsNew, selectIsSaveAsNewButtonHidden, selectCanEnterEditModeAndIsLoaded, selectCanCreateAnalyticalDashboard, selectIsExport, function (isEditModeDevRollout, isSaveAsNewEnabled, isSaveAsButtonHidden, isDashboardEditable, canCreateDashboard, isExport) {
    /*
     * The reasoning behind this condition is as follows. Do not show separate Save As button if:
     *
     * 0.  edit mode rollout flag enabled
     *
     * 1.  The feature is not enabled or
     * 2.  If is disabled by config
     * 3.  If the dashboard can be edited; in this case, the save as option is part of the dropdown menu;
     *     it is somewhat more hidden
     * 4.  dashboard is not in export mode
     * 5.  If the user cannot create dashboards - e.g. does not have permissions to do so (is viewer for example).
     */
    return (isEditModeDevRollout &&
        isSaveAsNewEnabled &&
        !isSaveAsButtonHidden &&
        !isDashboardEditable &&
        !isExport &&
        canCreateDashboard);
});
/**
 * @internal
 */
export function useSaveAsNewButtonProps() {
    var dashboardDispatch = useDashboardDispatch();
    var isVisible = useDashboardSelector(selectIsSaveAsNewButtonVisible);
    var onSaveAsNewClick = useCallback(function () {
        dashboardDispatch(uiActions.openSaveAsDialog());
    }, [dashboardDispatch]);
    return {
        isVisible: isVisible,
        onSaveAsNewClick: onSaveAsNewClick,
    };
}
/**
 * @internal
 */
export function DefaultSaveAsNewButton(_a) {
    var isVisible = _a.isVisible, onSaveAsNewClick = _a.onSaveAsNewClick;
    var intl = useIntl();
    if (!isVisible) {
        return null;
    }
    return (React.createElement(Button, { className: "gd-button-secondary s-save_as_new_button", value: intl.formatMessage({ id: "save.as.new" }), onClick: onSaveAsNewClick }));
}
//# sourceMappingURL=DefaultSaveAsNewButton.js.map