// (C) 2019-2022 GoodData Corporation
import React, { useCallback } from "react";
import { insightVisualizationUrl, objRefToString, widgetRef } from "@gooddata/sdk-model";
import { stringUtils } from "@gooddata/util";
import cx from "classnames";
import { useIntl } from "react-intl";
import { Bubble, BubbleHoverTrigger } from "@gooddata/sdk-ui-kit";
import { selectCanExportReport, selectSettings, useDashboardSelector } from "../../../../../model";
var nonExportableVisTypes = ["headline", "xirr"];
function isExportableVisualization(visType) {
    return !nonExportableVisTypes.includes(visType);
}
var bubbleAlignPoints = [{ align: "tc bc" }, { align: "tc br" }];
export var LegacyInsightMenuButton = function (_a) {
    var onClick = _a.onClick, widget = _a.widget, insight = _a.insight, isOpen = _a.isOpen;
    var intl = useIntl();
    var onOptionsMenuClick = useCallback(function () {
        onClick();
    }, [onClick]);
    var settings = useDashboardSelector(selectSettings);
    var canExportReport = useDashboardSelector(selectCanExportReport);
    var areExportsEnabled = settings.enableKPIDashboardExport;
    var hasExportReportPermissions = canExportReport;
    var visType = insightVisualizationUrl(insight).split(":")[1];
    var isExportableVisType = isExportableVisualization(visType);
    var canExportWidget = areExportsEnabled && hasExportReportPermissions && isExportableVisType;
    if (!canExportWidget) {
        return null;
    }
    var widgetRefValue = widgetRef(widget);
    var objRefAsString = widgetRefValue ? objRefToString(widgetRefValue) : "";
    var optionsIconClasses = cx("dash-item-action-options", "s-dash-item-action-options", "dash-item-action-options-" + stringUtils.simplifyText(objRefAsString), "s-dash-item-action-options-" + stringUtils.simplifyText(objRefAsString), "gd-icon-download", {
        "dash-item-action-options-active": isOpen,
    });
    return (React.createElement("div", { className: "dash-item-action-placeholder s-dash-item-action-placeholder", onClick: onOptionsMenuClick },
        React.createElement(BubbleHoverTrigger, { className: optionsIconClasses, showDelay: 500, hideDelay: 0, tagName: "div" },
            React.createElement(Bubble, { className: "bubble-primary", alignPoints: bubbleAlignPoints },
                React.createElement("span", null, intl.formatMessage({ id: "options.button.bubble" }))))));
};
//# sourceMappingURL=LegacyInsightMenuButton.js.map